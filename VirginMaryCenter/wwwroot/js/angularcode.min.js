(function () {
    var ocrApp = angular.module('app', ['ngSanitize']);

    
    /*    $.connection.hub.url = OCRServiceSyncUrl;
        $.connection.hub.logging = true;
        $.connection.hub.start();
        */
    

  /*  $.connection.hub.error(function (err) {
        console.log('SignalR error occured: ' + err);
    });
   

    //this adds a service called chat that you can then use in the controller by passing it as a parameter
    angular.module('app')
        .value('OCRSync', $.connection.OCRsync);
 */
})();
angular.module('app').directive('ngEsc', function () {
    return function (scope, element, attrs) {
        element.bind("keydown keypress keyup", function (event) {
            if (event.which === 27) {
                scope.$apply(function () {
                    scope.$eval(attrs.ngEsc);
                });

                event.preventDefault();
            }
        });
    };
});    
 
angular.module('app').controller('eventCtrl', ['$scope', '$window', '$http', '$sce', function ($scope, $window, $http, $sce) {
    $scope.loading = true;
    $scope.eventPeriods =
        {
            "live": {
                name: "LIVE EVENTS",
                data: []
            },
            "upcoming": {
                name: "UPCOMING EVENTS",
                data: []
            },
            "past": {
                name: "PAST EVENTS",
                data: [] 
            }
        };

    $scope.eventView = function () {
        $scope.loading = true;

        $http({
            method: 'GET',
            url: "/api/events",
            params: {
            }
        }).then(function successCallback(response) {
            var eventsAll = JSON.parse(response.data).data
            $scope.eventPeriods["live"].data = eventsAll.filter(e => new Date(e.start_time) >= new Date() && new Date(e.end_time) <= new Date());
            $scope.eventPeriods["upcoming"].data = eventsAll.filter(e => new Date(e.start_time) >= new Date());
            $scope.eventPeriods["past"].data = eventsAll.filter(e => new Date(e.start_time) < new Date());

            console.log($scope.eventPeriods);
            $scope.loading = false;
        }, function errorCallback(response) {
            $scope.hasError = true;
        });
    };


    $scope.eventView();

}]);